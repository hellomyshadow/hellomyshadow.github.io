<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Spring,">










<meta name="description" content="虚拟化1. 虚拟化：计算机中的一种资源管理技术;     1. 将计算机的各种实体资源，如服务器、网络、内存及存储等，予以抽象、转换后呈现出来;     2. 打破实体结构间的不可切割障碍，使用户可以比原本的组态更好地应用这些资源;     3. 而且，这些资源的新虚拟部分不受现有资源的架构方式、地域、物理组态所限制. 2. 一般所说的虚拟化资源包括计算能力和资料存储; 3. 在实际生产环境中，虚">
<meta name="keywords" content="Spring">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker">
<meta property="og:url" content="http://hellomyshadow.github.io/2016/06/01/Docker/index.html">
<meta property="og:site_name" content="大麦田程序猿">
<meta property="og:description" content="虚拟化1. 虚拟化：计算机中的一种资源管理技术;     1. 将计算机的各种实体资源，如服务器、网络、内存及存储等，予以抽象、转换后呈现出来;     2. 打破实体结构间的不可切割障碍，使用户可以比原本的组态更好地应用这些资源;     3. 而且，这些资源的新虚拟部分不受现有资源的架构方式、地域、物理组态所限制. 2. 一般所说的虚拟化资源包括计算能力和资料存储; 3. 在实际生产环境中，虚">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://hellomyshadow.github.io/2016/06/01/Docker/比较.jpg">
<meta property="og:updated_time" content="2019-06-18T11:53:04.023Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Docker">
<meta name="twitter:description" content="虚拟化1. 虚拟化：计算机中的一种资源管理技术;     1. 将计算机的各种实体资源，如服务器、网络、内存及存储等，予以抽象、转换后呈现出来;     2. 打破实体结构间的不可切割障碍，使用户可以比原本的组态更好地应用这些资源;     3. 而且，这些资源的新虚拟部分不受现有资源的架构方式、地域、物理组态所限制. 2. 一般所说的虚拟化资源包括计算能力和资料存储; 3. 在实际生产环境中，虚">
<meta name="twitter:image" content="http://hellomyshadow.github.io/2016/06/01/Docker/比较.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://hellomyshadow.github.io/2016/06/01/Docker/">





  <title>Docker | 大麦田程序猿</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">大麦田程序猿</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://hellomyshadow.github.io/2016/06/01/Docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="大麦田怪圈">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大麦田程序猿">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Docker</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-06-01T00:00:00+08:00">
                2016-06-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaEE/" itemprop="url" rel="index">
                    <span itemprop="name">JavaEE</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="虚拟化"><a href="#虚拟化" class="headerlink" title="虚拟化"></a>虚拟化</h2><pre><code>1. 虚拟化：计算机中的一种资源管理技术;
    1. 将计算机的各种实体资源，如服务器、网络、内存及存储等，予以抽象、转换后呈现出来;
    2. 打破实体结构间的不可切割障碍，使用户可以比原本的组态更好地应用这些资源;
    3. 而且，这些资源的新虚拟部分不受现有资源的架构方式、地域、物理组态所限制.
2. 一般所说的虚拟化资源包括计算能力和资料存储;
3. 在实际生产环境中，虚拟化技术主要用来解决高性能的物理硬件产能过剩和老旧的硬件产能过低的重组重用，
   透明化底层物理硬件，从而最大化地利用物理硬件，充分利用资源;
4. 虚拟化技术的种类有很多：软件虚拟化、硬件虚拟化、内存虚拟化、网络虚拟化、桌面虚拟化、服务虚拟化、虚拟机...
</code></pre><h2 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h2><pre><code>1. Docker是一个诞生于2013年初的开源项目，最初是dotCloud公司内部的一个业余项目，基于谷歌的Go语言实现;
2. Docker项目后来加入了Linux基金会，遵从Apache2.0协议，在Github上维护;
3. Docker项目的目标是实现轻量级的操作系统虚拟化解决方案，Docker的基础是Linux容器(LXC)等技术;
4. Docker在LXC的基础上做了进一步封装，让用户操作Docker容器时就像操作一个快速轻量级的虚拟机一样简便;
5. Docker的优点
    1. 上手快：Docker依赖于写时复制模型，使修改应用程序非常迅速，Docker容器启动快，性能高，占用资源少，
    同一台宿主机中可以运行更多的容器，尽可能的利用系统资源;
    2. 职责的逻辑分类：开发者只需要关心容器中的应用程序，运维人员只需要关心如何管理容器，Docker的设计目的
    就是加强开发环境和生产环境的一致性;
    3. 快速高效的开发生命周期：缩短开发-测试-部署-上线的周期，让应用程序具备可移植性，易于构建、协作;
    4. 鼓励使用面向服务的架构：Docker鼓励使用面向服务的体系结构和微服务架构，推荐单个容器只运行一个应用程序
    或进程，从而形成一个分布式的应用程序模型，扩展和调试都变得简单，同时也提高了程序的内省性;
7. 与传统的虚拟机相比，Docker启动速度更快，占用体积更小;
</code></pre><p><img src="//hellomyshadow.github.io/2016/06/01/Docker/比较.jpg" alt="比较"></p>
<h3 id="服务器与客户端"><a href="#服务器与客户端" class="headerlink" title="服务器与客户端"></a>服务器与客户端</h3><pre><code>1. Docker是C/S架构，Docker客户端只需要向服务端(守护进程)发送请求，由服务端完成所有工作并返回结果;
2. Docker提供了一个命令行工具，以及一整套RESTful API;
3. 可以在同一台宿主机上运行Docker守护进程和客户端，也可以从本地的Docker客户端连接到远程Docker守护进程;
    Docker客户端 --&gt; Docker守护进程(Docker服务端) --&gt; Docker容器
</code></pre><h3 id="Docker镜像与容器"><a href="#Docker镜像与容器" class="headerlink" title="Docker镜像与容器"></a>Docker镜像与容器</h3><pre><code>1. 镜像是构建Docker的基石，用户基于镜像来运行自己的容器，镜像也是Docker生命周期中的 构建 部分;
2. 镜像和容器的关系类似于类和对象，一个镜像可以创建多个容器;
3. 镜像是基于联合文件系统的一种层式结构，由一系列指令一步步构建处理;
    1. 比如：添加一个文件 --&gt; 执行一个命令 --&gt; 打开一个窗口;
    2. 也可以把镜像当作容器的源代码，它的体积很小，易于分享、存储和更新;
4. Docker可以帮助构建和部署容器，用户只需把自己的应用程序/服务打包、放进容器即可;
    1. 容器是基于镜像启动的，容器中可以运行一个或多个进程;
    2. 简言之，镜像是Docker生命周期中的构建/打包阶段，容器是启动/执行阶段;
    3. 容器基于镜像启动，一旦容器启动完成后，就可以登录到容器中安装自己需要的软件/服务;
5. Docker容器：一个镜像格式，一系列标准操作，一个执行环境;
    1. Docker容器借鉴了标准集装箱的概念，不同的是，集装箱运输货物，Docker运输软件;
    2. 和集装箱一样，Docker不关心容器中装了什么，不管是Web服务器，还是数据库，亦或者是应用程序服务器;
    3. 所有的容器都按照相同的方式将内容装载进去;
    4. Docker也不关心容器要运往何方，可以在本地构建容器，上传到Registry，然后下载到一个物理/虚拟的服务器来测试;
6. 像标准集装箱一样，Docker容器便于替换，可以叠加，易于分发，且尽量通用;
</code></pre><h3 id="Registry"><a href="#Registry" class="headerlink" title="Registry"></a>Registry</h3><pre><code>1. Registry：注册中心，Docker用来保存用户构建的镜像;
2. Registry分为公共和私有，Docker公司运营公共的Registry称为Docker Hub;
3. 用户可以在Docker Hub上注册账号，分享并保存自己的镜像;
4. Docker Hub在国外服务器上，下载镜像巨慢，可以构建自己的私有Registry;
</code></pre><h2 id="Docker安装-CentOS"><a href="#Docker安装-CentOS" class="headerlink" title="Docker安装(CentOS)"></a>Docker安装(CentOS)</h2><pre><code>1. Docker是基于Ubuntu发布的，最先更新或打补丁的也是在Ubuntu系统中，所以官方建议安装在Ubuntu系统中;
2. 在CentOS系统中安装时，CentOS版本要求为7.x
    1. yum包更新到最新版：sudo yum update
    2. 安装需要的软件包：yum-utils提供yum-config-manager功能，另外两个是devicemapper驱动依赖;
    sudo yum install -y yum-utils device-mapper-persistent-data lvm2
    3. 设置yum源为阿里云
    sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
    4. 安装docker
    sudo yum install docker-ce  ===&gt; -ce表示社区版，免费的
    5. 查看docker版本
    docker -v
3. 设置ustc的镜像
    1. ustc是老牌的Linux镜像服务提供者，ustc的docker镜像加速器非常快;
    2. 而且，ustc docker mirror无需注册，是真正的公共服务;
    3. 编辑 /etc/docker/daemon.json，加入国内镜像
    {
      &quot;registry-mirrors&quot;: [&quot;https://docker.mirrors.ustc.edu.cn&quot;]
    }
4. systemctl：系统服务管理器指令
    1. 启动docker
        systemctl start docker
    2. 停止docker
        systemctl stop docker
    3. 重启docker
        systemctl restart docker
    4. 查看docker状态
        systemctl status docker
    5. 开机自启动
        systemctl enable docker
    6. 查看docker的概要信息
        docker info
    7. docker命令的帮助文档
        docker --help
</code></pre><h2 id="镜像相关命令"><a href="#镜像相关命令" class="headerlink" title="镜像相关命令"></a>镜像相关命令</h2><pre><code>1. 查看镜像：docker images，查看本地已经存在的镜像;
    1. REPOSITORY(镜像名称)、TAG(镜像标签)、IMAGE ID(镜像id)、CREATED(镜像创建日期)、SIZE(镜像大小)
    2. 镜像都是存储在Docker宿主机的 /var/lib/docker 目录下;
2. 搜索镜像：docker search 镜像名称，从网络中查找需要的镜像;
    1. NAME(镜像名称)、DESCRIPTION(镜像描述)、STARS(用户评价)、OFFICIAL(是否官方)
    2. AUTOMATED(自动构建)，该镜像是否由Docker Hub自动构建流程创建的;
3. 拉取镜像：docker pull 镜像名称，从中央仓库中下载镜像到本地;
    1. 比如，下载CentOS7镜像：docker pull centos:7
    2. centos:7 表示在拉取centOS镜像时,指定其TAG为7，也就是版本，如果不指定TAG，默认是最新的版本latest
4. 删除镜像
    1. 按照镜像ID删除：docker rmi 镜像ID
    2. 删除所有镜像：docker rmi `docker images -q`
</code></pre><h2 id="容器相关命令"><a href="#容器相关命令" class="headerlink" title="容器相关命令"></a>容器相关命令</h2><pre><code>1. 查看容器
    1. 所有容器：docker ps -a
    2. 正在运行的容器：docker ps
    3. 最后一次运行的容器：docker ps -l
    4. 停止的容器：docker ps -f status=exited
2. 创建容器：docker run
    1. -i：表示运行容器;
    2. -t：表示容器启动后进入其命令行，-i 和 -t 同时使用时，容器创建就会登录进去，即分配一个伪终端;
    3. --name：为创建的容器命名，容器名称必须是唯一的，命名时不能重复;
    4. -v：表示目录映射关系，前者是宿主机目录，后者是映射到宿主机上的目录;
    5. 可以使用多个 -v 映射不同目录/文件，最好只做目录映射，在宿主机上做修改，然后共享到容器上;
    6. -d：创建一个运行在后台的守护式容器，这样创建容器后不会自动登录;
    7. -p：表示端口映射，前者是宿主机端口，后者是容器内的映射端口，可以使用多个 -p 做不同的端口映射;
3. 交互式创建容器
    docker run -it --name=容器名称 镜像名称:标签 /bin/bash
    1. 通过指定的镜像创建容器，镜像名称可能重复，所以要指定其标签;
    2. /bin/bash 表示加载宿主机(CentOS)的命令行，容器创建后会自动登录进去;
    3. exit：退出当前容器，重新回到宿主机;
4. 守护式创建容器
    docker run -di --name=容器名称 镜像名称:标签
    1. 登录守护式容器
        docker exec -it 容器名称或ID /bin/bash
    2. 交互式与守护式的区别：登录进入容器之后，执行 exit 命令，交互式容器会自动停止，守护式不会;
5. 文件拷贝
    1. 将宿主机的目录/文件拷贝到容器中
        docker cp 需要拷贝的文件/目录 容器名称:容器目录
    2. 将容器中的目录/文件拷贝到宿主机中
        docker cp 容器名称:容器目录/文件  宿主机目录
6. 目录挂载
    1. 在创建容器时，将宿主机的目录与容器内的目录进行映射，这样在修改其中一方的目录文件时，就会影响到另一方;
    docker run -di -v /usr/local/myhtml:/usr/local/myhtml --name=mycentos centos:7
    2. 如果共享的是多级目录，可能会出现权限不足的提示，这是因为CentOS7中的安全模块selinux把权限禁止了;
    3. --privileged=true：用于解决挂载的目录没有权限的问题;
7. 查看容器的IP
    1. docker inspect 容器名称或ID：可以查看容器运行的各种数据;
    2. 还可以只查看IP地址
    docker inspect --format=&apos;{{.NetworkSettings.IPAddress}}&apos; 容器名称或ID
8. 停止、启动、删除容器(运行中的容器无法删除)
    docker stop/start/rm 容器名称或ID
</code></pre><h2 id="应用部署"><a href="#应用部署" class="headerlink" title="应用部署"></a>应用部署</h2><h3 id="MySQL部署"><a href="#MySQL部署" class="headerlink" title="MySQL部署"></a>MySQL部署</h3><pre><code>1. 拉取MySQL镜像
    docker pull centos/mysql-57-centos7
2. 创建容器
    docker run -di --name=test_mysql -p 33306:3306 -e MYSQL_ROOT_PASSWORD=123456 centos/mysql-57-centos7
    1. -p：表示端口映射，宿主机映射端口:容器运行端口，通过宿主机端口33306访问容器端口3306;
    2. -e：表示添加环境变量 MYSQL_ROOT_PASSWORD 是root用户的登录密码;
3. 进入MySQL容器
    docker exec -it test_mysql /bin/bash
4. 登录MySQL
    mysql -u root -p
5. 远程登录MySQL
    mysql -h宿主机的IP地址 -P33306 -uroot -p
</code></pre><h3 id="Tomcat部署"><a href="#Tomcat部署" class="headerlink" title="Tomcat部署"></a>Tomcat部署</h3><pre><code>1. 拉取镜像
    docker pull tomcat:7-jre7
2. 创建容器
    docker run -di --name=mytomcat -p 9000:8080 
        -v /usr/local/webapps:/usr/local/tomcat/webapps tomcat:7-jre7
3. 在宿主机 /usr/local/webapps 目录中部署一个web应用demo.war，远程访问：http://宿主机IP:9000/demo
</code></pre><h3 id="Nginx部署"><a href="#Nginx部署" class="headerlink" title="Nginx部署"></a>Nginx部署</h3><pre><code>1. 拉取镜像、创建Nginx容器
    docker pull nginx
    docker run -di --name=mynginx -p 80:80 nginx
2. 登录容器mynginx，自定义配置文件nginx.conf
3. 远程访问：http://宿主机IP  ==&gt; 默认展示 Welcome to nginx!
</code></pre><h3 id="Redis部署"><a href="#Redis部署" class="headerlink" title="Redis部署"></a>Redis部署</h3><pre><code>1. 拉取镜像、创建容器
    docker pull redis
    docker run -di --name=myredis -p 6379:6379 redis
2. 远程登录：redis-cli -h 宿主机IP
</code></pre><h2 id="迁移与备份"><a href="#迁移与备份" class="headerlink" title="迁移与备份"></a>迁移与备份</h2><pre><code>1. 容器保存为镜像
    docker commit 容器名称(mynginx) 镜像名称(mynginx_i)
    1. 查看本地存在的镜像：docker images
    2. 利用保存的镜像创建容器
    docker run -di --name=mynginx2 -p 82:80 mynginx_i
2. 镜像备份(tar文件)
    docker save -o 备份文件(mynginx.tar) 镜像名称(mynginx_i)
3. 镜像恢复
    1. 先删除掉原有镜像创建的容器，然后才能删除原有的镜像
        docker rm mynginx2
        docker rmi mynginx_i
    2. 最后通过其备份恢复镜像;
        docker load -i 备份文件(mynginx.tar)
</code></pre><h2 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h2><pre><code>1. Dockerfile是由一系列命令和参数构建的脚本，这些命令应用于基础镜像，并最终创建一个新的镜像;
    1. 对于开发人员：可以为开发团队提供一个完全一致的开发环境;
    2. 对于测试人员：直接使用开发时所构建的镜像，或者通过Dockerfile构建一个新的镜像，就可以开始工作了;
    3. 对于运维人员：在部署时，可以实现应用的无缝移植;
2. 最基础的镜像：Ubuntu、CentOS
3. 常用命令
    1. FROM image_name:tag：定义了使用哪个基础镜像启动构建流程，如果该镜像不存在，则自动下载;
    2. MAINTAINER user_name：声明镜像的创建者;
    3. ENV key value：设置环境变量，可以有多条;
    4. RUN command：Dockerfile的核心部分，可以有多条;
    5. ADD source_dir/file dest_dir/file：将宿主机的文件复制到容器中，对于压缩文件，将会在复制后自动解压;
    6. COPY source_dir/file dest_dir/file：与 ADD 类似，但不会对压缩文件进行解压;
    7. WORKDIR path_dir：设置容器(当前构建的镜像所创建的容器)的工作目录;
    8. 其他命令操作容器的相对目录/文件时，都会基于设置的工作目录，登录进容器后，所处的目录也是设置的工作目录;
</code></pre><h3 id="构建镜像"><a href="#构建镜像" class="headerlink" title="构建镜像"></a>构建镜像</h3><pre><code>使用CentOS7作为基础镜像，构建一个JDK1.8镜像;
1. 创建目录
    mkdir -p /usr/local/dockerjdk8
2. 准备linux版本的jdk8，放在 dockerjdk8 目录中：jdk-8uxxx-linux-x64.tar.gz
3. 在 dockerjdk8 目录中编辑 Dockerfile
    cd /usr/local/dockerjdk8
    vi Dockerfile
4. Dockerfile的内容
    FROM centos:7
    MAINTAINER testman
    # 切换工作目录
    WORKDIR /usr
    RUN mkdir /usr/local/java
    ADD jdk-8uxxx-linux-x64.tar.gz /usr/local/java/
    # 设置java的环境变量
    ENV JAVA_HOME /usr/local/java/jdk1.8.0_xxx
    ENV JRE_HOME $JAVA_HOME/jre
    ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib:$CLASSPATH
    ENV PATH $JAVA_HOME/bin:$PATH
5. 构建镜像：
    docker build -t=&apos;jdk1.8&apos; .
    1. -t 用于指定镜像名称;
    2. . 表示当前目录，用于指定Dockerfile所在的目录;
6. 查看镜像是否建立完成：docker images
</code></pre><h2 id="Docker私有仓库"><a href="#Docker私有仓库" class="headerlink" title="Docker私有仓库"></a>Docker私有仓库</h2><pre><code>1. 搭建
    1. 拉取私有仓库的镜像
        docker pull registry
    2. 创建私有仓库容器
        docker run -di --name=registry -p 5000:5000 registry
    3. 私服地址：宿主机IP:5000
    4. 远程访问：http://宿主机IP:5000/v2/_catalog  ===&gt; {&quot;repositories&quot;:[]}，表示搭建成功
2. 修改daemon.json，加入私服地址;
    vi /etc/docker/daemon.json
    1. 加入内容：{&quot;insecure-registries&quot;:[&quot;宿主机IP:5000&quot;]}
    {
      &quot;registry-mirrors&quot;: [&quot;https://docker.mirrors.ustc.edu.cn&quot;],
      &quot;insecure-registries&quot;: [&quot;宿主机IP:5000&quot;]
    }
    2. 让docker信任私有仓库的地址，重启docker让配置生效;
    systemctl restart docker
    docker start registry  # 启动私服容器
3. 上传镜像到私有仓库
    1. 标记此镜像为私有仓库的镜像：docker tag 镜像名 私服地址/镜像名
    docker tag jdk1.8 宿主机IP:5000/jdk1.8  ==&gt; docker images可以查看被标记的镜像
    2. 上传标记的镜像：docker push 私服地址/镜像名
    docker push 宿主机IP:5000/jdk1.8
4. 查看私服上的镜像
    http://宿主机IP:5000/v2/_catalog  ==&gt; {&quot;repositories&quot;:[&quot;jdk1.8&quot;]}
</code></pre><h2 id="DockerMaven"><a href="#DockerMaven" class="headerlink" title="DockerMaven"></a>DockerMaven</h2><pre><code>1. 微服务的部署方式
    1. 手动部署：把项目打包生成jar/war包，手动上传到宿主机上，再拷贝到docker容器中;
    2. 自动部署：通过Maven插件实现自动部署;
2. 自动部署的配置
    1. docker默认不允许远程访问，需要修改配置
        vi /lib/systemd/system/docker.service
    2. 在 ExecStart= 后面添加 -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock
        ExecStart=/usr/bin/dockerd -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock
    3. 刷新配置，重启服务
    systemctl daemon-reload
    systemctl restart docker
    docker start registry
    4. 修改待部署项目的 pom.xml
    &lt;build&gt;
        &lt;finalName&gt;app&lt;/finalName&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
            &lt;!-- docker的maven插件 --&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;com.spotify&lt;/groupId&gt;
                &lt;artifactId&gt;docker-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;0.4.11&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;imageName&gt;宿主机IP:5000/${project.artifactId}:${project.version}&lt;/imageName&gt;
                    &lt;baseImage&gt;jdk1.8&lt;/baseImage&gt;
                    &lt;entryPoint&gt;[&quot;java&quot;, &quot;-jar&quot;, &quot;/${project.build.finalName}.jar&quot;]&lt;/entryPoint&gt;
                    &lt;resources&gt;
                        &lt;resource&gt;
                            &lt;targetPath&gt;/&lt;/targetPath&gt;
                            &lt;directory&gt;${project.build.directory}&lt;/directory&gt;
                            &lt;include&gt;${project.build.finalName}.jar&lt;/include&gt;
                        &lt;/resource&gt;
                    &lt;/resources&gt;
                    &lt;dockerHost&gt;http://宿主机IP:2375&lt;/dockerHost&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
3. docker-maven的配置部分：&lt;configuration&gt;
    1. &lt;imageName&gt;：最终生成的工程镜像;
    2. &lt;baseImage&gt;：指定基础镜像，等效于Dockerfile中的 FROM jdk1.8，所以宿主机上必须要存在镜像jdk1.8
    3. &lt;entryPoint&gt;：入口点，等效于Dockerfile中的 ENTRYPOINT [&quot;java&quot;, &quot;-jar&quot;, &quot;/app.jar&quot;]
    4. &lt;resources&gt;：指定上传的源工程，等效于Dockerfile中的 ADD app.jar /
4. docker-maven的作用就是代替Dockerfile，实现自动编译与上传;
5. 命令行进入工程根目录，打包项目，构建镜像，并上传到私服仓库
    mvn clean package docker:build -DpushImage  # -DpushImage 表示构建完成之后就上传;
6. 进入宿主机，查看镜像：docker images
    宿主机IP:5000/工程名(REPOSITORY)  版本号(TAG)
7. 查看私服上的镜像
    http://宿主机IP:5000/v2/_catalog  ==&gt; {&quot;repositories&quot;:[&quot;jdk1.8&quot;,&quot;工程名&quot;]}
8. 进入宿主机，使用上传的工程镜像创建容器
    docker run -di --name=mytest -p 9001:工程监听的端口号 宿主机IP:5000/工程名:版本号
9. 访问工程的接口 http://宿主机IP:9000/xxxx
</code></pre><hr>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Spring/" rel="tag"># Spring</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/05/14/SpringCloud项目5/" rel="next" title="SpringCloud项目5">
                <i class="fa fa-chevron-left"></i> SpringCloud项目5
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/06/02/持续集成/" rel="prev" title="持续集成">
                持续集成 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">大麦田怪圈</p>
              <p class="site-description motion-element" itemprop="description">敢做就能赢！</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">65</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">28</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#虚拟化"><span class="nav-number">1.</span> <span class="nav-text">虚拟化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker"><span class="nav-number">2.</span> <span class="nav-text">Docker</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#服务器与客户端"><span class="nav-number">2.1.</span> <span class="nav-text">服务器与客户端</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker镜像与容器"><span class="nav-number">2.2.</span> <span class="nav-text">Docker镜像与容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Registry"><span class="nav-number">2.3.</span> <span class="nav-text">Registry</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker安装-CentOS"><span class="nav-number">3.</span> <span class="nav-text">Docker安装(CentOS)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#镜像相关命令"><span class="nav-number">4.</span> <span class="nav-text">镜像相关命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#容器相关命令"><span class="nav-number">5.</span> <span class="nav-text">容器相关命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#应用部署"><span class="nav-number">6.</span> <span class="nav-text">应用部署</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL部署"><span class="nav-number">6.1.</span> <span class="nav-text">MySQL部署</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Tomcat部署"><span class="nav-number">6.2.</span> <span class="nav-text">Tomcat部署</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Nginx部署"><span class="nav-number">6.3.</span> <span class="nav-text">Nginx部署</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redis部署"><span class="nav-number">6.4.</span> <span class="nav-text">Redis部署</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#迁移与备份"><span class="nav-number">7.</span> <span class="nav-text">迁移与备份</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dockerfile"><span class="nav-number">8.</span> <span class="nav-text">Dockerfile</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#构建镜像"><span class="nav-number">8.1.</span> <span class="nav-text">构建镜像</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker私有仓库"><span class="nav-number">9.</span> <span class="nav-text">Docker私有仓库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DockerMaven"><span class="nav-number">10.</span> <span class="nav-text">DockerMaven</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">大麦田怪圈</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
